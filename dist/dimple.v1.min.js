var dimple={version:"1.0.0",plot:{},aggregateMethod:{}};!function(){"use strict";dimple.axis=function(a,b,c,d){this.chart=a,this.position=b,this.categoryFields=c,this.measure=d,this.hidden=!1,this.showPercent=!1,this.colors=null,this.overrideMin=null,this.overrideMax=null,this.shapes=null,this.showGridlines=null,this.gridlineShapes=null,this.titleShape=null,this._scale=null,this._min=0,this._max=0,this._previousOrigin=null,this._origin=null,this._draw=null,this._getFormat=function(){var a,b,c,d,e,f,g;return this.showPercent?a=d3.format("%"):null!==this.measure?(b=Math.floor(Math.abs(this._max),0).toString(),c=Math.floor(Math.abs(this._min),0).toString(),d=Math.max(c.length,b.length),d>3?(e=Math.min(Math.floor((d-1)/3),4),f="kmBT".substring(e-1,e),g=2>=d-3*e?1:0,a=function(a){return 0===a?0:d3.format(",."+g+"f")(a/Math.pow(1e3,e))+f}):(g=2>=d?1:0,a=d3.format(",."+g+"f"))):a=function(a){return a},a},this._hasCategories=function(){return null!=this.categoryFields&&void 0!=this.categoryFields&&this.categoryFields.length>0},this._hasMeasure=function(){return null!=this.measure&&void 0!=this.measure},this._update=function(b){if(this._min=this.showPercent&&this._min<-1?this._min=-1:this._min,this._max=this.showPercent&&this._max>1?this._max=1:this._max,this._min=null!=this.overrideMin?this.overrideMin:this._min,this._max=null!=this.overrideMax?this.overrideMax:this._max,this.position.length>0&&"x"==this.position[0]){if(null==this.measure||void 0==this.measure){var c=[];this.chart.data.forEach(function(a){-1==c.indexOf(a[this.categoryFields[0]])&&c.push(a[this.categoryFields[0]])},this),this._scale=d3.scale.ordinal().rangePoints([this.chart.x,this.chart.x+this.chart.width]).domain(c.concat([""]))}else this._scale=d3.scale.linear().range([this.chart.x,this.chart.x+this.chart.width]).domain([this._min,this._max]).nice();if(!this.hidden)switch(a._axisIndex(this,"x")){case 0:this._draw=d3.svg.axis().orient("bottom").scale(this._scale);break;case 1:this._draw=d3.svg.axis().orient("top").scale(this._scale)}}else if(this.position.length>0&&"y"==this.position[0]){if(null==this.measure||void 0==this.measure){var c=[];this.chart.data.forEach(function(a){-1==c.indexOf(a[this.categoryFields[0]])&&c.push(a[this.categoryFields[0]])},this),this._scale=d3.scale.ordinal().rangePoints([this.chart.y+this.chart.height,this.chart.y]).domain(c.concat([""]))}else this._scale=d3.scale.linear().range([this.chart.y+this.chart.height,this.chart.y]).domain([this._min,this._max]).nice();if(!this.hidden)switch(a._axisIndex(this,"y")){case 0:this._draw=d3.svg.axis().orient("left").scale(this._scale);break;case 1:this._draw=d3.svg.axis().orient("right").scale(this._scale)}}else this.position.length>0&&"z"==this.position[0]?this._scale=d3.scale.linear().range([this.chart.height/300,this.chart.height/10]).domain([this._min,this._max]):this.position.length>0&&"c"==this.position[0]&&(this._scale=d3.scale.linear().range([0,null==this.colors||1==this.colors.length?1:this.colors.length-1]).domain([this._min,this._max]));if((null==b||void 0==b||0==b)&&null!=this._scale&&null!=this._scale.ticks&&this._scale.ticks(10).length>0){var d=this._scale.ticks(10),e=d[1]-d[0],f=((this._max-this._min)%e).toFixed(0);0!=f&&(this._max=Math.ceil(this._max/e)*e,this._min=Math.floor(this._min/e)*e,this._update(!0))}var g=this._scale.copy()(0);return this._origin!=g&&(this._previousOrigin=null==this._origin?g:this._origin,this._origin=g),this}},dimple.chart=function(a,b){this.svg=a,this.x=.1*a[0][0].width.baseVal.value,this.y=.1*a[0][0].height.baseVal.value,this.width=.8*a[0][0].width.baseVal.value,this.height=.8*a[0][0].height.baseVal.value,this.data=b,this.noFormats=!1,this.axes=[],this.series=[],this.legends=[],this.storyboard=null,this.titleShape=null,this.shapes=null,this._group=a.append("g"),this._assignedColors={},this._nextColor=0,this._axisIndex=function(a,b){var c=0,d=0;for(c=0;c<this.axes.length;c++){if(this.axes[c]==a)return d;(null==b||void 0==b||b[0]==this.axes[c].position[0])&&d++}return-1},this._getSeriesData=function(){null!==this.series&&void 0!==this.series&&this.series.forEach(function(a){var b=[],c=function(a,b){var c=[];return null!=a&&a._hasCategories()&&a.categoryFields.forEach(function(a){c.push(b[a])},this),c},d={x:!1,y:!1,z:!1,c:!1},e={x:[],y:[]};this.data.forEach(function(f){var g=-1,h=c(a.x,f),i=c(a.y,f),j=c(a.z,f),k=[];null==a.categoryFields||void 0==a.categoryFields||0==a.categoryFields.length?k=["All"]:1==a.categoryFields.length&&void 0==f[a.categoryFields[0]]?k=[a.categoryFields[0]]:a.categoryFields.forEach(function(a){k.push(f[a])},this);for(var l=k.join("/")+"_"+h.join("/")+"_"+i.join("/")+"_"+j.join("/"),m=0;m<b.length;m++)if(b[m].key==l){g=m;break}if(-1==g){var n={key:l,aggField:k,xField:h,xValue:null,xCount:0,yField:i,yValue:null,yCount:0,zField:j,zValue:null,zCount:0,cValue:0,cCount:0,x:0,y:0,xOffset:0,yOffset:0,width:0,height:0,cx:0,cy:0,xBound:0,yBound:0,xValueList:[],yValueList:[],zValueList:[],cValueList:[],fill:{},stroke:{}};b.push(n),g=b.length-1}var o=function(c,h,i){var j=!0;if(null!=i){var k=i.getFrameValue(),l="";i.categoryFields.forEach(function(a,b){b>0&&(l+="/"),l+=f[a],j=l==k},this)}if(null!=c&&void 0!=c&&null!=c.measure&&void 0!=c.measure&&j){var m=b[g];-1==m[c.position+"ValueList"].indexOf(f[c.measure])&&m[c.position+"ValueList"].push(f[c.measure]),isNaN(parseFloat(f[c.measure]))&&(d[c.position]=!0),m[c.position+"Value"]=a.aggregate(m[c.position+"Value"],m[c.position+"Count"],f[c.measure],1),m[c.position+"Count"]++}null!=c&&void 0!=c&&c._hasCategories()&&c.categoryFields.length>1&&void 0!=e[c.position]&&-1==e[c.position].indexOf(f[c.categoryFields[1]])&&e[c.position].push(f[c.categoryFields[1]])};o(a.x,this.data,this.storyboard),o(a.y,this.data,this.storyboard),o(a.z,this.data,this.storyboard),o(a.c,this.data,this.storyboard)},this);var f={x:[],y:[],z:[]},g={min:null,max:null};b.forEach(function(b){if(null!=a.x){1==d.x&&(b.xValue=b.xValueList.length);var c=(null==f.x[b.xField.join("/")]?0:f.x[b.xField.join("/")])+(a.y._hasMeasure()?Math.abs(b.yValue):0);f.x[b.xField.join("/")]=c}if(null!=a.y){1==d.y&&(b.yValue=b.yValueList.length);var c=(null==f.y[b.yField.join("/")]?0:f.y[b.yField.join("/")])+(a.x._hasMeasure()?Math.abs(b.xValue):0);f.y[b.yField.join("/")]=c}if(null!=a.z){1==d.z&&(b.zValue=b.zValueList.length);var c=(null==f.z[b.zField.join("/")]?0:f.z[b.zField.join("/")])+(a.z._hasMeasure()?Math.abs(b.zValue):0);f.z[b.zField.join("/")]=c}null!=a.c&&((null==g.min||b.cValue<g.min)&&(g.min=b.cValue),(null==g.max||b.cValue>g.max)&&(g.max=b.cValue))},this),b.sort(function(a,b){return a.aggField!=b.aggField?a.aggField.join("/")<b.aggField.join("/")?-1:1:a.xField!=b.xField?a.xField.join("/")<b.xField.join("/")?-1:1:a.yField!=b.yField?a.yField.join("/")<b.yField.join("/")?-1:1:a.zField!=b.zField?a.zField.join("/")<b.zField.join("/")?-1:1:0});var h={x:[],y:[],z:[]},i=[],j={},k={x:0,y:0,z:0};for(var l in f.x)f.x.hasOwnProperty(l)&&(k.x+=f.x[l]);for(var l in f.y)f.y.hasOwnProperty(l)&&(k.y+=f.y[l]);for(var l in f.z)f.z.hasOwnProperty(l)&&(k.z+=f.z[l]);b.forEach(function(b){var c=function(c,d,g){if(null!=c&&void 0!=c){var l=c.position;if(c._hasCategories())if(c._hasMeasure()){var m=b[c.position+"Field"].join("/"),n=c.showPercent?f[c.position][m]/k[c.position]:f[c.position][m];-1==i.indexOf(m)&&(j[m]=n+(i.length>0?j[i[i.length-1]]:0),i.push(m));var o=b[l+"Bound"]=b["c"+l]="x"!=l&&"y"!=l||!a.stacked?n:j[m];b[g]=n,b[l]=o-("x"==l&&n>=0||"y"==l&&0>=n?n:0)}else b[l]=b["c"+l]=b[l+"Field"][0],b[g]=1,void 0!=e[l]&&null!=e[l]&&e[l].length>=2&&(b[l+"Offset"]=e[l].indexOf(b[l+"Field"][1]),b[g]=1/e[l].length);else{var n=c.showPercent?b[l+"Value"]/f[d][b[d+"Field"].join("/")]:b[l+"Value"],m=b[d+"Field"].join("/")+(b[l+"Value"]>=0),p=h[l][m]=(null==h[l][m]||"z"==l?0:h[l][m])+n,o=b[l+"Bound"]=b["c"+l]="x"!=l&&"y"!=l||!a.stacked?n:p;b[g]=n,b[l]=o-("x"==l&&n>=0||"y"==l&&0>=n?n:0)}}};if(c(a.x,"y","width"),c(a.y,"x","height"),c(a.z,"z","r"),null!=a.c&&g.min!=g.max){var d,l;b.cValue=b.cValue>g.max?g.max:b.cValue<g.min?g.min:b.cValue;var m=d3.scale.linear().range([0,null==a.c.colors||1==a.c.colors.length?1:a.c.colors.length-1]).domain([g.min,g.max]),n=m(b.cValue),o=n-Math.floor(n);null!=a.c.colors&&void 0!=a.c.colors&&1==a.c.colors.length?(d=d3.rgb(a.c.colors[0]),l=d3.rgb(this.getColor(b.aggField.slice(-1)[0]).fill)):null!=a.c.colors&&void 0!=a.c.colors&&a.c.colors.length>1?(d=d3.rgb(a.c.colors[Math.floor(n)]),l=d3.rgb(a.c.colors[Math.ceil(n)])):(d=d3.rgb("white"),l=d3.rgb(this.getColor(b.aggField.slice(-1)[0]).fill)),d.r=Math.floor(d.r+(l.r-d.r)*o),d.g=Math.floor(d.g+(l.g-d.g)*o),d.b=Math.floor(d.b+(l.b-d.b)*o),b.fill=d.toString(),b.stroke=d.darker(.5).toString()}},this),a._positionData=b},this)},this._registerEventHandlers=function(a){null!=a._eventHandlers&&a._eventHandlers.length>0&&a._eventHandlers.forEach(function(b){null!=b.handler&&"function"==typeof b.handler&&a.shapes.on(b.event,function(c){var d=new dimple.eventArgs;null!=a.chart.storyboard&&(d.frameValue=a.chart.storyboard.getFrameValue()),d.seriesValue=c.aggField,d.xValue=c.x,d.yValue=c.y,d.zValue=c.z,d.colorValue=c.cValue,d.seriesShapes=a.shapes,d.selectedShape=d3.select(this),b.handler(d)})},this)},this.addAxis=function(a,b,c){null!=b&&void 0!=b&&(b=[].concat(b));var d=new dimple.axis(this,a,b,c);return this.axes.push(d),d},this.addCategoryAxis=function(a,b){return this.addAxis(a,b,null)},this.addColorAxis=function(a,b){var c=this.addAxis("c",null,a);return c.colors=null==b||void 0==b?null:[].concat(b),c},this.addLegend=function(a,b,c,d,e,f){f=null==f||void 0==f?this.series:[].concat(f),e=null==e||void 0==e?"left":e;var g=new dimple.legend(this,a,b,c,d,e,f);return this.legends.push(g),g},this.addMeasureAxis=function(a,b){return this.addAxis(a,null,b)},this.addPctAxis=function(a,b){var c=this.addMeasureAxis(a,b);return c.showPercent=!0,c},this.addSeries=function(a,b,c){null==c&&(c=this.axes),null==b&&(b=dimple.plot.bubble);var d=null,e=null,f=null,g=null;c.forEach(function(a){null!=a&&b.supportedAxes.indexOf(a.position)>-1&&(null==d&&"x"==a.position[0]?d=a:null==e&&"y"==a.position[0]?e=a:null==f&&"z"==a.position[0]?f=a:null==g&&"c"==a.position[0]&&(g=a))},this),null!=a&&void 0!=a&&(a=[].concat(a));var h=new dimple.series(this,a,d,e,f,g,b,dimple.aggregateMethod.sum,b.stacked);return this.series.push(h),h},this.assignColor=function(a,b,c,d){return this._assignedColors[a]=new dimple.color(b,c,d),this._assignedColors[a]},this.defaultColors=[new dimple.color("#80B1D3"),new dimple.color("#FB8072"),new dimple.color("#FDB462"),new dimple.color("#B3DE69"),new dimple.color("#FFED6F"),new dimple.color("#BC80BD"),new dimple.color("#8DD3C7"),new dimple.color("#CCEBC5"),new dimple.color("#FFFFB3"),new dimple.color("#BEBADA"),new dimple.color("#FCCDE5"),new dimple.color("#D9D9D9")],this.draw=function(a){a=null==a||void 0==a?0:a;var b=null,c=null;this._getSeriesData(),this.axes.forEach(function(a){if(a._min=0,a._max=0,null!=a.measure&&void 0!=a.measure){var d=!1;this.series.forEach(function(b){if(b[a.position]==a){var c=b._axisBounds(a.position);a._min>c.min&&(a._min=c.min),a._max<c.max&&(a._max=c.max),d=!0}},this),d||this.data.forEach(function(b){a._min>b[a.measure]&&(a._min=b[a.measure]),a._max<b[a.measure]&&(a._max=b[a.measure])},this)}else{a._min=0;var e=[];this.data.forEach(function(b){-1==e.indexOf(b[a.categoryFields[0]])&&e.push(b[a.categoryFields[0]])},this),a._max=e.length}a._update(),null==b&&"x"==a.position?b=a:null==c&&"y"==a.position&&(c=a)},this);var d=!1,e=!1;return this.axes.forEach(function(f){var g=!1;null==f.gridlineShapes?(f.showGridlines||null==f.showGridlines&&!f._hasCategories()&&(!d&&"x"==f.position||!e&&"y"==f.position))&&(f.gridlineShapes=this._group.append("g").attr("class","gridlines"),"x"==f.position?d=!0:e=!0):"x"==f.position?d=!0:e=!0,null==f.shapes&&(f.shapes=this._group.append("g").attr("class","axis"),g=!0);var h=null,i=0,j=null;f==b&&null!=c?(h="translate(0, "+(null==c.categoryFields||0==c.categoryFields.length?c._scale(0):this.y+this.height)+")",j="translate(0, "+(f==b?this.y+this.height:this.y)+")",i=-this.height):f==c&&null!=b?(h="translate("+(null==b.categoryFields||0==b.categoryFields.length?b._scale(0):this.x)+", 0)",j="translate("+(f==c?this.x:this.x+this.width)+", 0)",i=-this.width):"x"==f.position?(j=h="translate(0, "+(f==b?this.y+this.height:this.y)+")",i=-this.height):"y"==f.position&&(j=h="translate("+(f==c?this.x:this.x+this.width)+", 0)",i=-this.width);var k=function(b){return null==h||0==a||g?b:b.transition().duration(a)};null!=h&&null!=f._draw&&(k(f.shapes).call(f._draw.tickFormat(f._getFormat())).attr("transform",h),null!=f.gridlineShapes&&k(f.gridlineShapes).call(f._draw.tickSize(i,0,0).tickFormat("")).attr("transform",j),(null==f.measure||void 0==f.measure)&&("x"==f.position?k(f.shapes.selectAll(".axis text")).attr("x",this.width/f._max/2):"y"==f.position&&k(f.shapes.selectAll(".axis text")).attr("y",-1*(this.height/f._max)/2)),null!=f.categoryFields&&void 0!=f.categoryFields&&f.categoryFields.length>0&&(f!=b||null!=c.categoryFields&&0!=c.categoryFields.length||k(f.shapes.selectAll(".axis text")).attr("y",this.y+this.height-c._scale(0)+9),f!=c||null!=b.categoryFields&&0!=b.categoryFields.length||k(f.shapes.selectAll(".axis text")).attr("x",-1*(b._scale(0)-this.x)-9))),this.noFormats||(k(f.shapes.selectAll(".axis text")).style("font-family","sans-serif").style("font-size",(this.height/35>10?this.height/35:10)+"px"),k(f.shapes.selectAll(".axis path, .axis line")).style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),null!=f.gridlineShapes&&k(f.gridlineShapes.selectAll(".gridlines line")).style("fill","none").style("stroke","lightgray").style("opacity",.8));var l=!1;if(null==f.measure||void 0==f.measure)if(f==b){var m=0;f.shapes.selectAll(".axis text").each(function(){var a=this.getComputedTextLength();m=a>m?a:m}),m>this.width/f._max&&(l=!0,this.width/f._max/2,f.shapes.selectAll(".axis text").style("text-anchor","start").each(function(){var a=this.getBBox();d3.select(this).attr("transform","rotate(90,"+a.x+","+(a.y+a.height/2)+") translate(-5, 0)")}))}else if("x"==f.position){var m=0;f.shapes.selectAll(".axis text").each(function(){var a=this.getComputedTextLength();m=a>m?a:m}),m>this.width/f._max&&(this.width/f._max/2,f.shapes.selectAll(".axis text").style("text-anchor","end").each(function(){var a=this.getBBox();d3.select(this).attr("transform","rotate(90,"+(a.x+a.width)+","+(a.y+a.height/2)+") translate(5, 0)")}))}if(null==f.titleShape&&null!=f.shapes&&null!=f.shapes.node().firstChild){var n={l:null,t:null,r:null,b:null};f.shapes.selectAll(".axis text").each(function(){var a=this.getBBox();n.l=null==n.l||a.x<n.l?a.x:n.l,n.t=l?null==n.t||a.y+a.width<n.t?a.y+a.width:n.t:null==n.t||a.y<n.t?a.y:n.t,n.r=null==n.r||a.x+a.width>n.r?a.x+a.width:n.r,n.b=l?null==n.b||a.y+a.width>n.b?a.y+a.width:n.b:null==n.b||a.y+a.height>n.b?a.y+a.height:n.b});var o=0,p=0,q="";"x"==f.position?(p=f==b?this.y+this.height+n.b+10:this.y+n.l+n.t-5,o=this.x+this.width/2):"y"==f.position&&(o=f==c?this.x+n.l-10:this.x+this.width+n.r+10,p=this.y+this.height/2,q="rotate(270, "+o+", "+p+")"),f.titleShape=this._group.append("text").attr("class","axis title");var r=this;f.titleShape.attr("x",o).attr("y",p).attr("text-anchor","middle").attr("transform",q).text(null==f.categoryFields||void 0==f.categoryFields||0==f.categoryFields.length?f.measure:f.categoryFields.join("/")).each(function(){r.noFormats||d3.select(this).style("font-family","sans-serif").style("font-size",(r.height/35>10?r.height/35:10)+"px")}),f==b?f.titleShape.each(function(){d3.select(this).attr("y",p+this.getBBox().height/1.65)}):f==c&&f.titleShape.each(function(){d3.select(this).attr("x",o+this.getBBox().height/1.65)})}},this),this.series.forEach(function(b){b.plot.draw(this,b,a),this._registerEventHandlers(b)},this),this.legends.forEach(function(b){b._draw(a)},this),null!=this.storyboard&&void 0!=this.storyboard&&(this.storyboard._drawText(),this.storyboard.autoplay&&this.storyboard.startAnimation()),this},this.getColor=function(a){return(null==this._assignedColors[a]||void 0==this._assignedColors[a])&&(this._assignedColors[a]=this.defaultColors[this._nextColor],this._nextColor=(this._nextColor+1)%this.defaultColors.length),this._assignedColors[a]},this.setBounds=function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this.axes.forEach(function(a){a._update()},this),this},this.setStoryboard=function(a,b){return this.storyboard=new dimple.storyboard(this,a),null!=b&&void 0!=b&&(this.storyboard.onTick=b),this.storyboard}},dimple.color=function(a,b,c){this.fill=a,this.stroke=null==b||void 0==b?d3.rgb(a).darker(.5).toString():b,this.opacity=null==c||void 0==c?.8:c},dimple.eventArgs=function(){this.seriesValue=null,this.xValue=null,this.yValue=null,this.zValue=null,this.colorValue=null,this.frameValue=null,this.seriesShapes=null,this.selectedShape=null},dimple.legend=function(a,c,d,e,f,g,h){this.chart=a,this.series=h,this.x=c,this.y=d,this.width=e,this.height=f,this.horizontalAlign=g,this.shapes=null,this._draw=function(c){var d=this._getEntries();(null!=this.shapes||void 0!=this.shapes)&&this.shapes.transition().duration(.2*c).attr("opacity",0).remove();var e=0,f=0,g=0,h=0,i=15,j=9,k=this,l=a._group.selectAll(".dontSelectAny").data(d).enter().append("g").attr("class","legend").attr("opacity",0);l.append("text").attr("id",function(a){return"legend_"+a.key}).attr("class","legendText").text(function(a){return a.key}).call(function(){a.noFormats||this.style("font-family","sans-serif").style("font-size",(a.height/35>10?a.height/35:10)+"px").style("shape-rendering","crispEdges")}).each(function(){var a=this.getBBox();a.width>e&&(e=a.width),a.height>f&&(f=a.height)}),l.append("rect").attr("class","legendKey").attr("height",j).attr("width",i),f=(j>f?j:f)+2,e+=i+20,l.each(function(a){g+e>k.width&&(g=0,h+=f),h>k.height?d3.select(this).remove():(d3.select(this).select("text").attr("x","left"==k.horizontalAlign?k.x+i+5+g:k.x+(k.width-g-e)+i+5).attr("y",function(){return k.y+h+this.getBBox().height/1.65}).attr("width",k.width).attr("height",k.height),d3.select(this).select("rect").attr("class","legend legendKey").attr("x","left"==k.horizontalAlign?k.x+g:k.x+(k.width-g-e)).attr("y",k.y+h).attr("height",j).attr("width",i).style("fill",function(){return b.fill(a,k.chart,a.series)}).style("stroke",function(){return b.stroke(a,k.chart,a.series)}).style("opacity",function(){return b.opacity(a,k.chart,a.series)}).style("shape-rendering","crispEdges"),g+=e)}),l.transition().delay(.2*c).duration(.8*c).attr("opacity",1),this.shapes=l},this._getEntries=function(){var a=[];return null!=this.series&&void 0!=this.series&&this.series.forEach(function(b){var c=b._positionData;c.forEach(function(c){for(var d=-1,e=0;e<a.length;e++)if(a[e].key==c.aggField.slice(-1)[0]){d=e;break}-1==d&&(a.push({key:c.aggField.slice(-1)[0],fill:c.fill,stroke:c.stroke,series:b,aggField:c.aggField}),d=a.length-1)})},this),a}},dimple.series=function(a,b,c,d,e,f,g,h,i){this.chart=a,this.x=c,this.y=d,this.z=e,this.c=f,this.plot=g,this.categoryFields=b,this.aggregate=h,this.stacked=i,this.barGap=.2,this.clusterBarGap=.1,this.lineWeight=2,this.lineMarkers=!1,this._eventHandlers=[],this._positionData=[],this._axisBounds=function(a){var b={min:0,max:0},g=null,h=null,i=[],j=0;"x"==a[0]?(g=c,h=d):"y"==a[0]?(g=d,h=c):"z"==a[0]?g=e:"c"==a[0]&&(g=f);var k=this._positionData;if(g.showPercent)k.forEach(function(a){a[g.position+"Bound"]<b.min&&(b.min=a[g.position+"Bound"]),a[g.position+"Bound"]>b.max&&(b.max=a[g.position+"Bound"])},this);else if(null==h||null==h.categoryFields||0==h.categoryFields.length)k.forEach(function(a){!this.stacked||"x"!=g.position&&"y"!=g.position?(a[g.position+"Value"]<b.min&&(b.min=a[g.position+"Value"]),a[g.position+"Value"]>b.max&&(b.max=a[g.position+"Value"])):a[g.position+"Value"]<0?b.min=b.min+a[g.position+"Value"]:b.max=b.max+a[g.position+"Value"]},this);else{var l=g.position+"Value",m=h.position+"Field",n=[];k.forEach(function(a){var b=a[m].join("/"),c=n.indexOf(b);-1==c&&(n.push(b),c=n.length-1),void 0==i[c]&&(i[c]={min:0,max:0},c>=j&&(j=c+1)),this.stacked?a[l]<0?i[c].min=i[c].min+a[l]:i[c].max=i[c].max+a[l]:(a[l]<i[c].min&&(i[c].min=a[l]),a[l]>i[c].max&&(i[c].max=a[l]))},this),i.forEach(function(a){void 0!=a&&(a.min<b.min&&(b.min=a.min),a.max>b.max&&(b.max=a.max))},this)}return b},this._dropLineOrigin=function(){var a=0,b=0,c={x:null,y:null},d={x:null,y:null};return this.chart.axes.forEach(function(a){"x"==a.position&&null===d.x?d.x=a._origin:"y"==a.position&&null===d.y&&(d.y=a._origin)},this),this.chart.axes.forEach(function(e){"x"!=e.position||this.x.hidden?"y"!=e.position||this.y.hidden||(e===this.y&&(0==b?c.x=d.x:1==b&&(c.x=this.chart.x+this.chart.width)),b++):(e===this.x&&(0==a?c.y=d.y:1==a&&(c.y=this.chart.y)),a++)},this),c},this.addEventHandler=function(a,b){this._eventHandlers.push({event:a,handler:b})}},dimple.storyboard=function(a,b){null!=b&&void 0!=b&&(b=[].concat(b)),this.chart=a,this.categoryFields=b,this.autoplay=!0,this.frameDuration=3e3,this.storyLabel=null,this.onTick=null,this._frame=0,this._animationTimer=null,this._categories=[],this._cachedCategoryFields=[],this._drawText=function(a){if(null==this.storyLabel||void 0==this.storyLabel){var b=this;this.storyLabel=this.chart._group.append("text").attr("x",this.chart.x+.01*this.chart.width).attr("y",this.chart.y+1.25*(this.chart.height/35>10?this.chart.height/35:10)).call(function(){b.noFormats||this.style("font-family","sans-serif").style("font-size",(b.height/35>10?b.height/35:10)+"px")})}this.storyLabel.transition().duration(.2*a).attr("opacity",0),this.storyLabel.transition().delay(.2*a).text(this.categoryFields.join("\\")+": "+this.getFrameValue()).transition().duration(.8*a).attr("opacity",1)},this._getCategories=function(){return this._categoryFields!=this._cachedCategoryFields&&(this._categories=[],this.chart.data.forEach(function(a){var b=-1;if(null!=this.categoryFields){var c="";this.categoryFields.forEach(function(b,d){d>0&&(c+="/"),c+=a[b]},this),b=this._categories.indexOf(c),-1==b&&(this._categories.push(c),b=this._categories.length-1)}},this),this._cachedCategoryFields=this._categoryFields),this._categories},this._goToFrameIndex=function(a){this._frame=a%this._getCategories().length,this.chart.draw(this.frameDuration/2)},this.getFrameValue=function(){return this._frame>=0&&this._getCategories().length>this._frame?this._getCategories()[this._frame]:null},this.goToFrame=function(a){if(this._getCategories().length>0){var b=this._getCategories().indexOf(a);this._goToFrameIndex(b)}},this.pauseAnimation=function(){null!=this._animationTimer&&(clearInterval(this._animationTimer),this._animationTimer=null)},this.startAnimation=function(){null==this._animationTimer&&(null!=this.onTick&&this.onTick(this.getFrameValue()),this._animationTimer=setInterval(function(a){return function(){a._goToFrameIndex(a._frame+1),null!=a.onTick&&a.onTick(a.getFrameValue()),a._drawText(a.frameDuration/2)}}(this),this.frameDuration))},this.stopAnimation=function(){null!=this._animationTimer&&(clearInterval(this._animationTimer),this._animationTimer=null,this._frame=0)}},dimple.aggregateMethod.avg=function(a,b,c,d){return a=null==a||void 0==a?0:a,c=null==c||void 0==c?0:c,(parseFloat(a)*parseFloat(b)+parseFloat(c)*parseFloat(d))/(parseFloat(b)+parseFloat(d))},dimple.aggregateMethod.count=function(a,b,c,d){return parseFloat(b)+parseFloat(d)},dimple.aggregateMethod.max=function(a,b,c){return parseFloat(a)>parseFloat(c)?parseFloat(a):parseFloat(c)},dimple.aggregateMethod.min=function(a,b,c){return null==a?parseFloat(c):parseFloat(a)<parseFloat(c)?parseFloat(a):parseFloat(c)},dimple.aggregateMethod.sum=function(a,b,c){return a=null==a||void 0==a?0:a,c=null==c||void 0==c?0:c,parseFloat(a)+parseFloat(c)},dimple.plot.area={stacked:!0,supportedAxes:["x","y","c"],draw:function(c,d,e){var f=this,g=d._positionData,h=[],i=1;(d.x._hasCategories()||d.y._hasCategories())&&(i=0),g.forEach(function(a){for(var b=[],c=!1,d=i;d<a.aggField.length;d++)b.push(a.aggField[d]);h.forEach(function(a){c=c||a.join("/")==b.join("/")},this),c||h.push(b)},this);var j=!1;null!=d.c&&void 0!=d.c&&(d.x._hasCategories()&&d.y._hasMeasure()||d.y._hasCategories()&&d.x._hasMeasure())&&(j=!0,h.forEach(function(b){a(b,"fill-area-gradient-"+b.join("_").replace(" ",""),d.x._hasCategories()?d.x:d.y,g,c,e,"fill"),a(b,"stroke-area-gradient-"+b.join("_").replace(" ",""),d.x._hasCategories()?d.x:d.y,g,c,e,"stroke")},this));var k=d3.svg.line().x(function(a){return b.cx(a,c,d)}).y(function(a){return b.cy(a,c,d)});(null==d.shapes||void 0==d.shapes)&&(d.shapes=c._group.selectAll(".area").data(h).enter().append("svg:path").attr("opacity",function(a){return c.getColor(a).opacity}));var l={};d.shapes.data(h).transition().duration(e).attr("class",function(a){return"series area "+a.join("_").replace(" ","")}).attr("d",function(a){var e=dimple.filterData(g,"aggField",a);e.sort(function(a,e){return d.x._hasCategories()?b.cx(a,c,d)<b.cx(e,c,d)?-1:1:d.y._hasCategories()?b.cy(a,c,d)<b.cy(e,c,d)?-1:1:0});for(var f=[],h=e.length-1;h>=0;h--){var i=e[h],j={cx:0,cy:0,height:0,width:0,xOffset:0,yOffset:0};if(d.x._hasCategories()){if(j.cx=i.cx,j.width=i.width,j.xOffset=i.xOffset,void 0==l[i.xField])l[i.xField]=[];else{var m=0;l[i.xField].forEach(function(a){(i.cy>=0&&a>=0||i.cy<=0&&0>=a)&&Math.abs(a)<=Math.abs(i.cy)&&Math.abs(a)>Math.abs(m)&&(m=a)},this),j.cy=m}f.push(j),l[i.xField].push(i.cy)}else if(d.y._hasCategories()){if(j.cy=i.cy,j.height=i.height,j.yOffset=i.yOffset,void 0==l[i.yField])l[i.yField]=[];else{var m=0;l[i.yField].forEach(function(a){(i.cx>=0&&a>=0||i.cx<=0&&0>=a)&&Math.abs(a)<=Math.abs(i.cx)&&Math.abs(a)>Math.abs(m)&&(m=a)},this),j.cx=m}f.push(j),l[i.yField].push(i.cx)}}return k(e.concat(f).concat(e[0]))}).call(function(){c.noFormats||this.attr("fill",function(a){return j?"url(#fill-area-gradient-"+a.join("_").replace(" ","")+")":c.getColor(a).fill}).attr("stroke",function(a){return j?"url(#stroke-area-gradient-"+a.join("_").replace(" ","")+")":c.getColor(a).stroke}).attr("stroke-width",d.lineWeight)});var m=c._group.selectAll(".markers").data(g).enter();d.lineMarkers&&m.append("circle").transition().duration(e).attr("cx",function(a){return b.cx(a,c,d)}).attr("cy",function(a){return b.cy(a,c,d)}).attr("r",2+d.lineWeight).attr("fill","white").attr("stroke","none"),m.append("circle").on("mouseover",function(a){f.enterEventHandler(a,this,c,d,e)}).on("mouseleave",function(a){f.leaveEventHandler(a,this,c,d,e)}).transition().duration(e).attr("cx",function(a){return b.cx(a,c,d)}).attr("cy",function(a){return b.cy(a,c,d)}).attr("r",2+d.lineWeight).attr("opacity",function(a){return d.lineMarkers?c.getColor(a).opacity:0}).call(function(){c.noFormats||this.attr("fill","white").style("stroke-width",d.lineWeight).attr("stroke",function(a){return b.stroke(a,c,d)})})},enterEventHandler:function(a,c,d,e){var f=5,g=10,h=750,i=d3.select(c),j=parseFloat(i.attr("cx")),k=parseFloat(i.attr("cy")),l=parseFloat(i.attr("r")),m=b.opacity(a,d,e),n=b.fill(a,d,e),o=e._dropLineOrigin();i.style("opacity",1);var p=d3.rgb(d3.rgb(n).r+.6*(255-d3.rgb(n).r),d3.rgb(n).g+.6*(255-d3.rgb(n).g),d3.rgb(n).b+.6*(255-d3.rgb(n).b)),q=d3.rgb(d3.rgb(n).r+.8*(255-d3.rgb(n).r),d3.rgb(n).g+.8*(255-d3.rgb(n).g),d3.rgb(n).b+.8*(255-d3.rgb(n).b)),r=d._group.append("g").attr("class","hoverShapes");r.append("circle").attr("cx",j).attr("cy",k).attr("r",l).attr("opacity",0).style("fill","none").style("stroke",n).style("stroke-width",1).transition().duration(h/2).ease("linear").attr("opacity",1).attr("r",l+4).style("stroke-width",2),null!==o.y&&r.append("line").attr("x1",j).attr("y1",k<o.y?k+l+4:k-l-4).attr("x2",j).attr("y2",k<o.y?k+l+4:k-l-4).style("fill","none").style("stroke",n).style("stroke-width",2).style("stroke-dasharray","3, 3").style("opacity",m).transition().delay(h/2).duration(h/2).ease("linear").attr("y2",o.y),null!==o.x&&r.append("line").attr("x1",j<o.x?j+l+4:j-l-4).attr("y1",k).attr("x2",j<o.x?j+l+4:j-l-4).attr("y2",k).style("fill","none").style("stroke",n).style("stroke-width",2).style("stroke-dasharray","3, 3").style("opacity",m).transition().delay(h/2).duration(h/2).ease("linear").attr("x2",o.x);var s=r.append("g"),t=s.append("rect"),u=[];null!=e.categoryFields&&void 0!=e.categoryFields&&e.categoryFields.length>0&&e.categoryFields.forEach(function(b,c){u.push(b+(a.aggField!=b?": "+a.aggField[c]:""))},this),e.x._hasCategories()?e.x.categoryFields.forEach(function(b,c){u.push(b+(a.xField!=b?": "+a.xField[c]:""))},this):u.push(e.x.measure+": "+e.x._getFormat()(a.cx)),e.y._hasCategories()?e.y.categoryFields.forEach(function(b,c){u.push(b+(a.yField!=b?": "+a.yField[c]:""))},this):u.push(e.y.measure+":"+e.y._getFormat()(a.cy)),null!=e.z&&void 0!=e.z&&u.push(e.z.measure+": "+e.z._getFormat()(a.zValue)),null!=e.c&&void 0!=e.c&&u.push(e.c.measure+": "+e.c._getFormat()(a.cValue)),u=u.filter(function(a,b){return u.indexOf(a)==b}),s.selectAll(".textHoverShapes").data(u).enter().append("text").text(function(a){return a}).style("font-family","sans-serif").style("font-size","10px");var v=0,w=0,x=0;s.each(function(){w=this.getBBox().width>w?this.getBBox().width:w,x=this.getBBox().width>x?this.getBBox().height:x}),s.selectAll("text").attr("x",0).attr("y",function(){return v+=this.getBBox().height,v-this.getBBox().height/2}),t.attr("x",-f).attr("y",-f).attr("height",Math.floor(v+f)-.5).attr("width",w+2*f).attr("rx",5).attr("ry",5).style("fill",q).style("stroke",p).style("stroke-width",2).style("opacity",.95);var y=j+l+f+g+w>parseFloat(d.svg.attr("width"));s.attr("transform","translate("+(y?j-(l+f+g+w):j+l+f+g)+" , "+(k-(v-(x-f))/2)+")")},leaveEventHandler:function(a,c,d,e){d3.select(c).style("opacity",e.lineMarkers?b.opacity(a,d,e):0),d._group.selectAll(".hoverShapes").remove()}},dimple.plot.bar={stacked:!0,supportedAxes:["x","y","c"],draw:function(a,c,d){var e=this;a._group.selectAll(".hoverShapes").transition().duration(d/4).style("opacity",0).remove();var f=c._positionData,g=null,h="series"+a.series.indexOf(c);g=null==c.shapes||void 0==c.shapes?a._group.selectAll("."+h).data(f):c.shapes.data(f,function(a){return a.key}),g.enter().append("rect").attr("id",function(a){return a.key}).attr("class",function(a){return h+" bar "+a.aggField.join(" ")+" "+a.xField.join(" ")+" "+a.yField.join(" ")}).attr("x",function(d){return b.x(d,a,c)}).attr("y",function(d){return b.y(d,a,c)+b.height(d,a,c)}).attr("width",function(d){return null!=d.xField&&d.xField.length>0?b.width(d,a,c):0}).attr("height",function(d){return null!=d.yField&&d.yField.length>0?b.height(d,a,c):0}).attr("opacity",function(d){return b.opacity(d,a,c)}).on("mouseover",function(b){e.enterEventHandler(b,this,a,c,d)}).on("mouseleave",function(b){e.leaveEventHandler(b,this,a,c,d)}).call(function(){a.noFormats||this.attr("fill",function(d){return b.fill(d,a,c)}).attr("stroke",function(d){return b.stroke(d,a,c)})}),g.transition().duration(d).attr("x",function(d){return b.x(d,a,c)}).attr("y",function(d){return b.y(d,a,c)}).attr("width",function(d){return b.width(d,a,c)}).attr("height",function(d){return b.height(d,a,c)}).call(function(){a.noFormats||this.attr("fill",function(d){return b.fill(d,a,c)}).attr("stroke",function(d){return b.stroke(d,a,c)})}),g.exit().transition().duration(d).attr("x",function(d){return b.x(d,a,c)}).attr("y",function(d){return b.y(d,a,c)}).attr("width",function(d){return b.width(d,a,c)}).attr("height",function(d){return b.height(d,a,c)}).each("end",function(){d3.select(this).remove()}),c.shapes=g},enterEventHandler:function(a,b,c,d){var e=5,f=10,g=750,h=d3.select(b),i=parseFloat(h.attr("x")),j=parseFloat(h.attr("y")),k=parseFloat(h.attr("width")),l=parseFloat(h.attr("height")),m=h.attr("opacity"),n=h.attr("fill"),o=d._dropLineOrigin(),p=d3.rgb(d3.rgb(n).r+.6*(255-d3.rgb(n).r),d3.rgb(n).g+.6*(255-d3.rgb(n).g),d3.rgb(n).b+.6*(255-d3.rgb(n).b)),q=d3.rgb(d3.rgb(n).r+.8*(255-d3.rgb(n).r),d3.rgb(n).g+.8*(255-d3.rgb(n).g),d3.rgb(n).b+.8*(255-d3.rgb(n).b)),r=c._group.append("g").attr("class","hoverShapes");
d.x._hasCategories()||null===o.y||r.append("line").attr("x1",i<d.x._origin?i+1:i+k-1).attr("y1",j<o.y?j+l:j).attr("x2",i<d.x._origin?i+1:i+k-1).attr("y2",j<o.y?j+l:j).style("fill","none").style("stroke",n).style("stroke-width",2).style("stroke-dasharray","3, 3").style("opacity",m).transition().delay(g/2).duration(g/2).ease("linear").attr("y2",o.y),d.y._hasCategories()||null===o.x||r.append("line").attr("x1",i<o.x?i+k:i).attr("y1",j<d.y._origin?j+1:j+l-1).attr("x2",i<o.x?i+k:i).attr("y2",j<d.y._origin?j+1:j+l-1).style("fill","none").style("stroke",n).style("stroke-width",2).style("stroke-dasharray","3, 3").style("opacity",m).transition().delay(g/2).duration(g/2).ease("linear").attr("x2",o.x);var s=r.append("g"),t=s.append("rect"),u=[];null!=d.categoryFields&&void 0!=d.categoryFields&&d.categoryFields.length>0&&d.categoryFields.forEach(function(b,c){u.push(b+(a.aggField!=b?": "+a.aggField[c]:""))},this),d.x._hasCategories()?d.x.categoryFields.forEach(function(b,c){u.push(b+(a.xField!=b?": "+a.xField[c]:""))},this):u.push(d.x.measure+": "+d.x._getFormat()(a.width)),d.y._hasCategories()?d.y.categoryFields.forEach(function(b,c){u.push(b+(a.yField!=b?": "+a.yField[c]:""))},this):u.push(d.y.measure+":"+d.y._getFormat()(a.height)),null!=d.c&&void 0!=d.c&&u.push(d.c.measure+": "+d.c._getFormat()(d.c.showPercent?a.cPct:a.cValue)),u=u.filter(function(a,b){return u.indexOf(a)==b}),s.selectAll(".textHoverShapes").data(u).enter().append("text").text(function(a){return a}).style("font-family","sans-serif").style("font-size","10px");var v=0,w=0,x=0;s.each(function(){w=this.getBBox().width>w?this.getBBox().width:w,x=this.getBBox().width>x?this.getBBox().height:x}),s.selectAll("text").attr("x",0).attr("y",function(){return v+=this.getBBox().height,v-this.getBBox().height/2}),t.attr("x",-e).attr("y",-e).attr("height",Math.floor(v+e)-.5).attr("width",w+2*e).attr("rx",5).attr("ry",5).style("fill",q).style("stroke",p).style("stroke-width",2).style("opacity",.95),i+k+e+f+w<parseFloat(c.svg.attr("width"))?s.attr("transform","translate("+(i+k+e+f)+" , "+(j+l/2-(v-(x-e))/2)+")"):i-(e+f+w)>0?s.attr("transform","translate("+(i-(e+f+w))+" , "+(j+l/2-(v-(x-e))/2)+")"):j+l+v+f+e<parseFloat(c.svg.attr("height"))?s.attr("transform","translate("+(i+k/2-(2*e+w)/2)+" , "+(j+l+2*e)+")"):s.attr("transform","translate("+(i+k/2-(2*e+w)/2)+" , "+(j-v-(x-e))+")")},leaveEventHandler:function(a,b,c){c._group.selectAll(".hoverShapes").remove()}},dimple.plot.bubble={stacked:!1,supportedAxes:["x","y","z","c"],draw:function(a,c,d){var e=this;a._group.selectAll(".hoverShapes").transition().duration(d/4).style("opacity",0).remove();var f=c._positionData,g=null,h="series"+a.series.indexOf(c);g=null==c.shapes||void 0==c.shapes?a._group.selectAll("."+h).data(f):c.shapes.data(f,function(a){return a.key}),g.enter().append("circle").attr("id",function(a){return a.key}).attr("class",function(a){return h+" bubble "+a.aggField.join(" ")+" "+a.xField.join(" ")+" "+a.yField.join(" ")+" "+a.zField.join(" ")}).attr("cx",function(){return c.x._previousOrigin}).attr("cy",function(){return c.y._previousOrigin}).attr("r",0).attr("opacity",function(d){return b.opacity(d,a,c)}).on("mouseover",function(b){e.enterEventHandler(b,this,a,c,d)}).on("mouseleave",function(b){e.leaveEventHandler(b,this,a,c,d)}).call(function(){a.noFormats||this.attr("fill",function(d){return b.fill(d,a,c)}).attr("stroke",function(d){return b.stroke(d,a,c)})}),g.transition().duration(d).attr("cx",function(d){return b.cx(d,a,c)}).attr("cy",function(d){return b.cy(d,a,c)}).attr("r",function(d){return b.r(d,a,c)}).call(function(){a.noFormats||this.attr("fill",function(d){return b.fill(d,a,c)}).attr("stroke",function(d){return b.stroke(d,a,c)})}),g.exit().transition().duration(d).attr("r",0).attr("cx",function(){return c.x._origin}).attr("cy",function(){return c.y._origin}).each("end",function(){d3.select(this).remove()}),c.shapes=g},enterEventHandler:function(a,b,c,d){var e=5,f=10,g=750,h=d3.select(b),i=parseFloat(h.attr("cx")),j=parseFloat(h.attr("cy")),k=parseFloat(h.attr("r")),l=h.attr("opacity"),m=h.attr("fill"),n=d._dropLineOrigin(),o=d3.rgb(d3.rgb(m).r+.6*(255-d3.rgb(m).r),d3.rgb(m).g+.6*(255-d3.rgb(m).g),d3.rgb(m).b+.6*(255-d3.rgb(m).b)),p=d3.rgb(d3.rgb(m).r+.8*(255-d3.rgb(m).r),d3.rgb(m).g+.8*(255-d3.rgb(m).g),d3.rgb(m).b+.8*(255-d3.rgb(m).b)),q=c._group.append("g").attr("class","hoverShapes");q.append("circle").attr("cx",i).attr("cy",j).attr("r",k).attr("opacity",0).style("fill","none").style("stroke",m).style("stroke-width",1).transition().duration(g/2).ease("linear").attr("opacity",1).attr("r",k+4).style("stroke-width",2),null!==n.y&&q.append("line").attr("x1",i).attr("y1",j<n.y?j+k+4:j-k-4).attr("x2",i).attr("y2",j<n.y?j+k+4:j-k-4).style("fill","none").style("stroke",m).style("stroke-width",2).style("stroke-dasharray","3, 3").style("opacity",l).transition().delay(g/2).duration(g/2).ease("linear").attr("y2",n.y),null!==n.x&&q.append("line").attr("x1",i<n.x?i+k+4:i-k-4).attr("y1",j).attr("x2",i<n.x?i+k+4:i-k-4).attr("y2",j).style("fill","none").style("stroke",m).style("stroke-width",2).style("stroke-dasharray","3, 3").style("opacity",l).transition().delay(g/2).duration(g/2).ease("linear").attr("x2",n.x);var r=q.append("g"),s=r.append("rect"),t=[];null!=d.categoryFields&&void 0!=d.categoryFields&&d.categoryFields.length>0&&d.categoryFields.forEach(function(b,c){t.push(b+(a.aggField!=b?": "+a.aggField[c]:""))},this),d.x._hasCategories()?d.x.categoryFields.forEach(function(b,c){t.push(b+(a.xField!=b?": "+a.xField[c]:""))},this):t.push(d.x.measure+": "+d.x._getFormat()(a.cx)),d.y._hasCategories()?d.y.categoryFields.forEach(function(b,c){t.push(b+(a.yField!=b?": "+a.yField[c]:""))},this):t.push(d.y.measure+":"+d.y._getFormat()(a.cy)),null!=d.z&&void 0!=d.z&&t.push(d.z.measure+": "+d.z._getFormat()(a.zValue)),null!=d.c&&void 0!=d.c&&t.push(d.c.measure+": "+d.c._getFormat()(a.cValue)),t=t.filter(function(a,b){return t.indexOf(a)==b}),r.selectAll(".textHoverShapes").data(t).enter().append("text").text(function(a){return a}).style("font-family","sans-serif").style("font-size","10px");var u=0,v=0,w=0;r.each(function(){v=this.getBBox().width>v?this.getBBox().width:v,w=this.getBBox().width>w?this.getBBox().height:w}),r.selectAll("text").attr("x",0).attr("y",function(){return u+=this.getBBox().height,u-this.getBBox().height/2}),s.attr("x",-e).attr("y",-e).attr("height",Math.floor(u+e)-.5).attr("width",v+2*e).attr("rx",5).attr("ry",5).style("fill",p).style("stroke",o).style("stroke-width",2).style("opacity",.95);var x=i+k+e+f+v>parseFloat(c.svg.attr("width"));r.attr("transform","translate("+(x?i-(k+e+f+v):i+k+e+f)+" , "+(j-(u-(w-e))/2)+")")},leaveEventHandler:function(a,b,c){c._group.selectAll(".hoverShapes").remove()}},dimple.plot.line={stacked:!1,supportedAxes:["x","y","c"],draw:function(c,d,e){var f=this,g=d._positionData,h=[],i=[],j=1;(d.x._hasCategories()||d.y._hasCategories())&&(j=0),g.forEach(function(a){for(var b=[],c=!1,d=j;d<a.aggField.length;d++)b.push(a.aggField[d]);i.forEach(function(a){c=c||a.join("/")==b.join("/")},this),c||i.push(b)},this);var k=!1;null!=d.c&&void 0!=d.c&&(d.x._hasCategories()&&d.y._hasMeasure()||d.y._hasCategories()&&d.x._hasMeasure())&&(k=!0,i.forEach(function(b){a(b,"fill-line-gradient-"+b.join("_").replace(" ",""),d.x._hasCategories()?d.x:d.y,g,c,e,"fill")},this));var l=d3.svg.line().x(function(a){return b.cx(a,c,d)}).y(function(a){return b.cy(a,c,d)});(null==d.shapes||void 0==d.shapes)&&(d.shapes=c._group.selectAll(".line").data(i).enter().append("svg:path").attr("opacity",function(a){return c.getColor(a).opacity})),d.shapes.data(i).transition().duration(e).attr("class",function(a){return"series line "+a.join("_").replace(" ","")}).attr("d",function(a){var e=[];return g.forEach(function(b){for(var c=!0,d=j;d<b.aggField.length;d++)c=c&&a[d-j]==b.aggField[d];c&&e.push(b)},this),e.sort(function(a,e){return d.x._hasCategories()?b.cx(a,c,d)<b.cx(e,c,d)?-1:1:d.y._hasCategories()?b.cy(a,c,d)<b.cy(e,c,d)?-1:1:0}),1==e.length&&(h.push({cx:b.cx(e[0],c,d),cy:b.cy(e[0],c,d),opacity:c.getColor(a[a.length-1]).opacity,color:c.getColor(a[a.length-1]).stroke}),d3.select(this).remove()),l(e)}).call(function(){c.noFormats||this.attr("fill","none").attr("stroke",function(a){return k?"url(#fill-line-gradient-"+a.join("_").replace(" ","")+")":c.getColor(a[a.length-1]).stroke}).attr("stroke-width",d.lineWeight)});var m=c._group.selectAll(".markers").data(g).enter();d.lineMarkers&&m.append("circle").transition().duration(e).attr("cx",function(a){return b.cx(a,c,d)}).attr("cy",function(a){return b.cy(a,c,d)}).attr("r",2+d.lineWeight).attr("fill","white").attr("stroke","none"),m.append("circle").on("mouseover",function(a){f.enterEventHandler(a,this,c,d,e)}).on("mouseleave",function(a){f.leaveEventHandler(a,this,c,d,e)}).transition().duration(e).attr("cx",function(a){return b.cx(a,c,d)}).attr("cy",function(a){return b.cy(a,c,d)}).attr("r",2+d.lineWeight).attr("opacity",function(a){return d.lineMarkers?c.getColor(a).opacity:0}).call(function(){c.noFormats||this.attr("fill","white").style("stroke-width",d.lineWeight).attr("stroke",function(a){return k?b.fill(a,c,d):c.getColor(a.aggField[a.aggField.length-1]).stroke})}),d.lineMarkers||c._group.selectAll(".fill").data(h).enter().append("circle").attr("cx",function(a){return a.cx}).attr("cy",function(a){return a.cy}).attr("r",d.lineWeight).attr("opacity",function(a){return a.opacity}).call(function(){c.noFormats||this.attr("fill",function(a){return a.color}).attr("stroke","none")})},enterEventHandler:function(a,c,d,e){var f=5,g=10,h=750,i=d3.select(c),j=parseFloat(i.attr("cx")),k=parseFloat(i.attr("cy")),l=parseFloat(i.attr("r")),m=b.opacity(a,d,e),n=i.attr("stroke"),o=e._dropLineOrigin();i.style("opacity",1);var p=d3.rgb(d3.rgb(n).r+.6*(255-d3.rgb(n).r),d3.rgb(n).g+.6*(255-d3.rgb(n).g),d3.rgb(n).b+.6*(255-d3.rgb(n).b)),q=d3.rgb(d3.rgb(n).r+.8*(255-d3.rgb(n).r),d3.rgb(n).g+.8*(255-d3.rgb(n).g),d3.rgb(n).b+.8*(255-d3.rgb(n).b)),r=d._group.append("g").attr("class","hoverShapes");r.append("circle").attr("cx",j).attr("cy",k).attr("r",l).attr("opacity",0).style("fill","none").style("stroke",n).style("stroke-width",1).transition().duration(h/2).ease("linear").attr("opacity",1).attr("r",l+e.lineWeight+2).style("stroke-width",2),null!==o.y&&r.append("line").attr("x1",j).attr("y1",k<o.y?k+l+e.lineWeight+2:k-l-e.lineWeight-2).attr("x2",j).attr("y2",k<o.y?k+l+e.lineWeight+2:k-l-e.lineWeight-2).style("fill","none").style("stroke",n).style("stroke-width",2).style("stroke-dasharray","3, 3").style("opacity",m).transition().delay(h/2).duration(h/2).ease("linear").attr("y2",o.y),null!==o.x&&r.append("line").attr("x1",j<o.x?j+l+e.lineWeight+2:j-l-e.lineWeight-2).attr("y1",k).attr("x2",j<o.x?j+l+e.lineWeight+2:j-l-e.lineWeight-2).attr("y2",k).style("fill","none").style("stroke",n).style("stroke-width",2).style("stroke-dasharray","3, 3").style("opacity",m).transition().delay(h/2).duration(h/2).ease("linear").attr("x2",o.x);var s=r.append("g"),t=s.append("rect"),u=[];null!=e.categoryFields&&void 0!=e.categoryFields&&e.categoryFields.length>0&&e.categoryFields.forEach(function(b,c){u.push(b+(a.aggField!=b?": "+a.aggField[c]:""))},this),e.x._hasCategories()?e.x.categoryFields.forEach(function(b,c){u.push(b+(a.xField!=b?": "+a.xField[c]:""))},this):u.push(e.x.measure+": "+e.x._getFormat()(a.cx)),e.y._hasCategories()?e.y.categoryFields.forEach(function(b,c){u.push(b+(a.yField!=b?": "+a.yField[c]:""))},this):u.push(e.y.measure+": "+e.y._getFormat()(a.cy)),null!=e.z&&void 0!=e.z&&u.push(e.z.measure+": "+e.z._getFormat()(a.zValue)),null!=e.c&&void 0!=e.c&&u.push(e.c.measure+": "+e.c._getFormat()(a.cValue)),u=u.filter(function(a,b){return u.indexOf(a)==b}),s.selectAll(".textHoverShapes").data(u).enter().append("text").text(function(a){return a}).style("font-family","sans-serif").style("font-size","10px");var v=0,w=0,x=0;s.each(function(){w=this.getBBox().width>w?this.getBBox().width:w,x=this.getBBox().width>x?this.getBBox().height:x}),s.selectAll("text").attr("x",0).attr("y",function(){return v+=this.getBBox().height,v-this.getBBox().height/2}),t.attr("x",-f).attr("y",-f).attr("height",Math.floor(v+f)-.5).attr("width",w+2*f).attr("rx",5).attr("ry",5).style("fill",q).style("stroke",p).style("stroke-width",2).style("opacity",.95);var y=j+l+f+g+w>parseFloat(d.svg.attr("width"));s.attr("transform","translate("+(y?j-(l+f+g+w):j+l+f+g)+" , "+(k-(v-(x-f))/2)+")")},leaveEventHandler:function(a,c,d,e){d3.select(c).style("opacity",e.lineMarkers?b.opacity(a,d,e):0),d._group.selectAll(".hoverShapes").remove()}};var a=function(a,b,c,d,e,f,g){var h=e._group.select("#"+b),i=[],j=c.position+"Field";d.forEach(function(a){-1==i.indexOf(a[j])&&i.push(a[j])},this),i=i.sort(function(a,b){return c._scale(a)-c._scale(b)});var k=!0;null==h.node()&&(k=!1,h=e._group.append("linearGradient").attr("id",b).attr("gradientUnits","userSpaceOnUse").attr("x1","x"==c.position?c._scale(i[0])+e.width/i.length/2:0).attr("y1","y"==c.position?c._scale(i[0])-e.height/i.length/2:0).attr("x2","x"==c.position?c._scale(i[i.length-1])+e.width/i.length/2:0).attr("y2","y"==c.position?c._scale(i[i.length-1])-e.height/i.length/2:0));var l=[];i.forEach(function(b,c){for(var e={},f=0;f<d.length;f++)if(d[f].aggField.join("_")==a.join("_")&&d[f][j].join("_")==b.join("_")){e=d[f];break}l.push({offset:Math.round(100*(c/(i.length-1)))+"%",color:e[g]})},this),k?h.selectAll("stop").data(l).transition().duration(f).attr("offset",function(a){return a.offset}).attr("stop-color",function(a){return a.color}):h.selectAll("stop").data(l).enter().append("stop").attr("offset",function(a){return a.offset}).attr("stop-color",function(a){return a.color})};dimple._getOrderedList=function(a,b,c){c=null==c||void 0==c?[]:[].concat(c),c=c.concat({ordering:b,desc:!1});var d=dimple._rollUp(a,b);if(c.length>=1){var e=[];c.forEach(function(a){var c=null===a.desc||void 0===a.desc?!1:a.desc,d=a.ordering;if("function"==typeof d)e.push(function(a,b){return(c?-1:1)*d(a,b)});else if(d instanceof Array){var f=[];d.forEach(function(a){f.push([].concat(a).join("|"))},this),e.push(function(a,d){var e="",g="";[].concat(b).forEach(function(b,c){e+=(c>0?"|":"")+a[b],g+=(c>0?"|":"")+d[b]},this),h=f.indexOf(e),i=f.indexOf(g);var h=0>h?c?-1:f.length:h,i=0>i?c?-1:f.length:i;return(c?-1:1)*(h-i)})}else{var g="string"==typeof d?d:null,h=function(a){var b=0;return a.forEach(function(a){b+=a}),b},i=function(a,b){var c=0;return isNaN(h(a))||isNaN(h(b))?isNaN(Date.parse(a[0]))||isNaN(Date.parse(b[0]))?a[0]<b[0]?c=-1:a[0]>b[0]&&(c=1):c=Date.parse(a[0])-Date.parse(b[0]):c=parseFloat(h(a))-parseFloat(h(b)),c};e.push(function(a,b){var d=0;return void 0!==a[g]&&void 0!==b[g]&&(d=i([].concat(a[g]),[].concat(b[g]))),(c?-1:1)*d})}}),d.sort(function(a,b){for(var c=0,d=0;c<e.length&&0==d;)d=e[c](a,b),c++;return d})}return d};var b={cx:function(a,c,d){return null!=d.x.measure&&void 0!=d.x.measure?d.x._scale(a.cx):null!=d.x.categoryFields&&void 0!=d.x.categoryFields&&d.x.categoryFields.length>=2?d.x._scale(a.cx)+b.xGap(a,c,d)+(a.xOffset+.5)*(c.width/d.x._max-2*b.xGap(a,c,d))*a.width:d.x._scale(a.cx)+c.width/d.x._max/2},cy:function(a,c,d){return null!=d.y.measure&&void 0!=d.y.measure?d.y._scale(a.cy):null!=d.y.categoryFields&&void 0!=d.y.categoryFields&&d.y.categoryFields.length>=2?d.y._scale(a.cy)-c.height/d.y._max+b.yGap(a,c,d)+(a.yOffset+.5)*(c.height/d.y._max-2*b.yGap(a,c,d))*a.height:d.y._scale(a.cy)-c.height/d.y._max/2},r:function(a,b,c){return null==c.z||void 0==c.z?5:c.z._hasMeasure()?c.z._scale(a.r):c.z._scale(b.height/100)},xGap:function(a,b,c){return(null==c.x.measure||void 0==c.x.measure)&&c.barGap>0?b.width/c.x._max*(c.barGap>.99?.99:c.barGap)/2:0},xClusterGap:function(a,c,d){return null!=d.x.categoryFields&&void 0!=d.x.categoryFields&&d.x.categoryFields.length>=2&&d.clusterBarGap>0?a.width*(c.width/d.x._max-2*b.xGap(a,c,d))*(d.clusterBarGap>.99?.99:d.clusterBarGap)/2:0},yGap:function(a,b,c){return(null==c.y.measure||void 0==c.y.measure)&&c.barGap>0?b.height/c.y._max*(c.barGap>.99?.99:c.barGap)/2:0},yClusterGap:function(a,c,d){return null!=d.y.categoryFields&&void 0!=d.y.categoryFields&&d.y.categoryFields.length>=2&&d.clusterBarGap>0?a.height*(c.height/d.y._max-2*b.yGap(a,c,d))*(d.clusterBarGap>.99?.99:d.clusterBarGap)/2:0},x:function(a,c,d){return d.x._scale(a.x)+b.xGap(a,c,d)+a.xOffset*(b.width(a,c,d)+2*b.xClusterGap(a,c,d))+b.xClusterGap(a,c,d)},y:function(a,c,d){return null!=d.y.measure&&void 0!=d.y.measure?d.y._scale(a.y):d.y._scale(a.y)-c.height/d.y._max+b.yGap(a,c,d)+a.yOffset*(b.height(a,c,d)+2*b.yClusterGap(a,c,d))+b.yClusterGap(a,c,d)},width:function(a,c,d){return null!=d.x.measure&&void 0!=d.x.measure?Math.abs(d.x._scale(a.width)-d.x._scale(0)):a.width*(c.width/d.x._max-2*b.xGap(a,c,d))-2*b.xClusterGap(a,c,d)},height:function(a,c,d){return null!=d.y.measure&&void 0!=d.y.measure?Math.abs(d.y._scale(0)-d.y._scale(a.height)):a.height*(c.height/d.y._max-2*b.yGap(a,c,d))-2*b.yClusterGap(a,c,d)},opacity:function(a,b,c){return null!=c.c&&void 0!=c.c?a.opacity:b.getColor(a.aggField.slice(-1)[0]).opacity},fill:function(a,b,c){return null!=c.c&&void 0!=c.c?a.fill:b.getColor(a.aggField.slice(-1)[0]).fill},stroke:function(a,b,c){return null!=c.c&&void 0!=c.c?a.stroke:b.getColor(a.aggField.slice(-1)[0]).stroke}};dimple._rollUp=function(a,b){var c=[];return b=null!=b&&void 0!=b?[].concat(b):[],a.forEach(function(a){var d=-1;c.forEach(function(c,e){if(-1==d){var f=!0;b.forEach(function(b){f=f&&a[b]==c[b]},this),f&&(d=e)}},this);var e={};-1!=d?e=c[d]:(b.forEach(function(b){e[b]=a[b]},this),c.push(e),d=c.length-1);for(var f in a)a.hasOwnProperty(f)&&-1==b.indexOf(f)&&(void 0==e[f]&&(e[f]=[]),e[f]=e[f].concat(a[f]));c[d]=e},this),c},dimple.filterData=function(a,b,c){if(null!=b&&null!=c){null!=c&&void 0!=c&&(c=[].concat(c));var d=[];return a.forEach(function(a){null==a[b]?d.push(a):c.indexOf([].concat(a[b]).join("/"))>-1&&d.push(a)},this),d}return a},dimple.getUniqueValues=function(a,b){var c=[];return null!=b&&void 0!=b&&(b=[].concat(b),a.forEach(function(a){var d="";b.forEach(function(b,c){c>0&&(d+="/"),d+=a[b]},this),-1==c.indexOf(d)&&c.push(d)},this)),c},dimple.newSvg=function(a,b,c){return null==parent&&(parent="body"),d3.select(a).append("svg").attr("width",b).attr("height",c)}}();